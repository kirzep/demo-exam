{% load static %}
{% for product in products %}
    {% if product.stock == 0 %}
        <div class="product-card out-of-stock" style="border: 1px solid #ccc; padding: 15px; width: 320px;">
    {% elif product.discount > 15 %}
        <div class="product-card high-discount" style="border: 1px solid #ccc; padding: 15px; width: 320px;">
    {% else %}
        <div class="product-card" style="border: 1px solid #ccc; padding: 15px; width: 320px;">
    {% endif %}

        <div style="text-align: center; margin-bottom: 15px;">
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" style="max-width: 100%; height: 200px; object-fit: contain;">
            {% else %}
                <img src="{% static 'images/picture.png' %}" alt="Заглушка" style="max-width: 100%; height: 200px; object-fit: contain;">
            {% endif %}
        </div>

        <h3 style="margin-top: 0;">{{ product.category }} | {{ product.name }}</h3>
        <p><strong>Описание товара:</strong> {{ product.description }}</p>
        <p><strong>Производитель:</strong> {{ product.manufacturer }}</p>
        <p><strong>Поставщик:</strong> {{ product.supplier }}</p>
        
        <p><strong>Цена:</strong> 
            {% if product.discount > 0 %}
                <span class="old-price">{{ product.price }}</span>
                <span class="new-price" style="font-weight: bold; font-size: 1.2em; margin-left: 10px;">{{ product.final_price }}</span>
            {% else %}
                <span style="font-weight: bold; font-size: 1.2em;">{{ product.price }}</span>
            {% endif %}
        </p>
        
        <p>
            <strong>Единица измерения:</strong> {{ product.unit }} <br>
            <strong>Количество на складе:</strong> {{ product.stock }}
        </p>
        
        {% if product.discount > 0 %}
            <p><strong>Действующая скидка:</strong> {{ product.discount }}%</p>
        {% endif %}
        {% if user.is_authenticated and user.role == 'admin' %}
            <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                <a href="{% url 'products:product_update' product.pk %}" class="btn-primary" style="background-color: #f0ad4e;">Изменить</a>
                <a href="{% url 'products:product_delete' product.pk %}" class="btn-primary" style="background-color: #d9534f; color: white;">Удалить</a>
            </div>
        {% endif %}
    </div>
{% empty %}
    <p>По вашему запросу ничего не найдено.</p>
{% endfor %}